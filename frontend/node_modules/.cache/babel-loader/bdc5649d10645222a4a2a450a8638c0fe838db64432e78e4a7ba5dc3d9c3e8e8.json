{"ast":null,"code":"var _s = $RefreshSig$();\nimport { useState, useEffect, useCallback, useMemo } from \"react\";\nimport { coursesAPI } from \"../services/api\";\nimport { useAuth } from \"../context/AuthContext\";\n\n/**\r\n * Custom hook for course search functionality\r\n * Implements efficient search with debouncing and caching\r\n */\nexport const useCourseSearch = (initialFilters = {}) => {\n  _s();\n  const {\n    user\n  } = useAuth();\n  const [courses, setCourses] = useState([]);\n  const [loading, setLoading] = useState(false);\n  const [error, setError] = useState(null);\n  const [searchTerm, setSearchTerm] = useState(\"\");\n  const [filters, setFilters] = useState({\n    is_active: \"true\",\n    // Default to active courses for students\n    ...initialFilters\n  });\n  const [pagination, setPagination] = useState({\n    currentPage: 1,\n    totalPages: 1,\n    totalCount: 0,\n    pageSize: 20\n  });\n\n  // Debounced search effect\n  useEffect(() => {\n    const timeoutId = setTimeout(() => {\n      if (searchTerm || Object.keys(filters).some(key => filters[key])) {\n        performSearch();\n      } else {\n        fetchCourses();\n      }\n    }, 300); // 300ms debounce\n\n    return () => clearTimeout(timeoutId);\n  }, [searchTerm, filters, pagination.currentPage, pagination.pageSize]);\n\n  // Main fetch function\n  const fetchCourses = useCallback(async () => {\n    try {\n      setLoading(true);\n      setError(null);\n      const params = {\n        page: pagination.currentPage,\n        page_size: pagination.pageSize\n      };\n\n      // Add search term if present\n      if (searchTerm.trim()) {\n        params.search = searchTerm.trim();\n      }\n\n      // Add filters\n      Object.keys(filters).forEach(key => {\n        if (filters[key] && filters[key] !== \"\") {\n          params[key] = filters[key];\n        }\n      });\n      console.log(\"ðŸ” Fetching courses with params:\", params);\n      const response = await coursesAPI.list(params);\n      console.log(\"ðŸ“Š Course search response:\", response.data);\n      const data = response.data;\n      setCourses(data.results || data || []);\n\n      // Update pagination\n      if (data.count !== undefined) {\n        setPagination(prev => ({\n          ...prev,\n          totalCount: data.count,\n          totalPages: Math.ceil(data.count / pagination.pageSize)\n        }));\n      }\n    } catch (err) {\n      console.error(\"âŒ Error fetching courses:\", err);\n      setError(err.message || \"Failed to fetch courses\");\n      setCourses([]);\n    } finally {\n      setLoading(false);\n    }\n  }, [searchTerm, filters, pagination.currentPage, pagination.pageSize]);\n\n  // Perform search with same logic as fetch\n  const performSearch = useCallback(fetchCourses, [fetchCourses]);\n\n  // Update search term\n  const updateSearchTerm = useCallback(term => {\n    setSearchTerm(term);\n    setPagination(prev => ({\n      ...prev,\n      currentPage: 1\n    })); // Reset to first page on search\n  }, []);\n\n  // Update filters\n  const updateFilters = useCallback(newFilters => {\n    setFilters(prev => ({\n      ...prev,\n      ...newFilters\n    }));\n    setPagination(prev => ({\n      ...prev,\n      currentPage: 1\n    })); // Reset to first page on filter change\n  }, []);\n\n  // Clear all filters and search\n  const clearSearch = useCallback(() => {\n    setSearchTerm(\"\");\n    setFilters({\n      is_active: (user === null || user === void 0 ? void 0 : user.role) === \"student\" ? \"true\" : \"\"\n    });\n    setPagination(prev => ({\n      ...prev,\n      currentPage: 1\n    }));\n  }, [user]);\n\n  // Go to specific page\n  const goToPage = useCallback(page => {\n    setPagination(prev => ({\n      ...prev,\n      currentPage: page\n    }));\n  }, []);\n\n  // Change page size\n  const changePageSize = useCallback(size => {\n    setPagination(prev => ({\n      ...prev,\n      pageSize: size,\n      currentPage: 1 // Reset to first page when changing page size\n    }));\n  }, []);\n\n  // Computed values\n  const hasActiveSearch = useMemo(() => {\n    return searchTerm.trim() !== \"\" || Object.keys(filters).some(key => filters[key] && filters[key] !== \"\" && !(key === \"is_active\" && filters[key] === \"true\" && (user === null || user === void 0 ? void 0 : user.role) === \"student\"));\n  }, [searchTerm, filters, user]);\n  const isEmpty = useMemo(() => courses.length === 0, [courses]);\n  const isFirstLoad = useMemo(() => pagination.currentPage === 1 && !hasActiveSearch && !loading, [pagination.currentPage, hasActiveSearch, loading]);\n  return {\n    // Data\n    courses,\n    loading,\n    error,\n    pagination,\n    // Search state\n    searchTerm,\n    filters,\n    hasActiveSearch,\n    isEmpty,\n    isFirstLoad,\n    // Actions\n    updateSearchTerm,\n    updateFilters,\n    clearSearch,\n    goToPage,\n    changePageSize,\n    refresh: fetchCourses,\n    // Computed helpers\n    totalResults: pagination.totalCount,\n    currentPageStart: (pagination.currentPage - 1) * pagination.pageSize + 1,\n    currentPageEnd: Math.min(pagination.currentPage * pagination.pageSize, pagination.totalCount)\n  };\n};\n_s(useCourseSearch, \"LdwzlZoT1EY1pLwqyyYYtJNjwU8=\", false, function () {\n  return [useAuth];\n});\nexport default useCourseSearch;","map":{"version":3,"names":["useState","useEffect","useCallback","useMemo","coursesAPI","useAuth","useCourseSearch","initialFilters","_s","user","courses","setCourses","loading","setLoading","error","setError","searchTerm","setSearchTerm","filters","setFilters","is_active","pagination","setPagination","currentPage","totalPages","totalCount","pageSize","timeoutId","setTimeout","Object","keys","some","key","performSearch","fetchCourses","clearTimeout","params","page","page_size","trim","search","forEach","console","log","response","list","data","results","count","undefined","prev","Math","ceil","err","message","updateSearchTerm","term","updateFilters","newFilters","clearSearch","role","goToPage","changePageSize","size","hasActiveSearch","isEmpty","length","isFirstLoad","refresh","totalResults","currentPageStart","currentPageEnd","min"],"sources":["D:/Projects/SCIQUS Project/frontend/src/hooks/useCourseSearch.js"],"sourcesContent":["import { useState, useEffect, useCallback, useMemo } from \"react\";\r\nimport { coursesAPI } from \"../services/api\";\r\nimport { useAuth } from \"../context/AuthContext\";\r\n\r\n/**\r\n * Custom hook for course search functionality\r\n * Implements efficient search with debouncing and caching\r\n */\r\nexport const useCourseSearch = (initialFilters = {}) => {\r\n  const { user } = useAuth();\r\n  const [courses, setCourses] = useState([]);\r\n  const [loading, setLoading] = useState(false);\r\n  const [error, setError] = useState(null);\r\n  const [searchTerm, setSearchTerm] = useState(\"\");\r\n  const [filters, setFilters] = useState({\r\n    is_active: \"true\", // Default to active courses for students\r\n    ...initialFilters,\r\n  });\r\n  const [pagination, setPagination] = useState({\r\n    currentPage: 1,\r\n    totalPages: 1,\r\n    totalCount: 0,\r\n    pageSize: 20,\r\n  });\r\n\r\n  // Debounced search effect\r\n  useEffect(() => {\r\n    const timeoutId = setTimeout(() => {\r\n      if (searchTerm || Object.keys(filters).some((key) => filters[key])) {\r\n        performSearch();\r\n      } else {\r\n        fetchCourses();\r\n      }\r\n    }, 300); // 300ms debounce\r\n\r\n    return () => clearTimeout(timeoutId);\r\n  }, [searchTerm, filters, pagination.currentPage, pagination.pageSize]);\r\n\r\n  // Main fetch function\r\n  const fetchCourses = useCallback(async () => {\r\n    try {\r\n      setLoading(true);\r\n      setError(null);\r\n\r\n      const params = {\r\n        page: pagination.currentPage,\r\n        page_size: pagination.pageSize,\r\n      };\r\n\r\n      // Add search term if present\r\n      if (searchTerm.trim()) {\r\n        params.search = searchTerm.trim();\r\n      }\r\n\r\n      // Add filters\r\n      Object.keys(filters).forEach((key) => {\r\n        if (filters[key] && filters[key] !== \"\") {\r\n          params[key] = filters[key];\r\n        }\r\n      });\r\n\r\n      console.log(\"ðŸ” Fetching courses with params:\", params);\r\n\r\n      const response = await coursesAPI.list(params);\r\n      console.log(\"ðŸ“Š Course search response:\", response.data);\r\n\r\n      const data = response.data;\r\n      setCourses(data.results || data || []);\r\n\r\n      // Update pagination\r\n      if (data.count !== undefined) {\r\n        setPagination((prev) => ({\r\n          ...prev,\r\n          totalCount: data.count,\r\n          totalPages: Math.ceil(data.count / pagination.pageSize),\r\n        }));\r\n      }\r\n    } catch (err) {\r\n      console.error(\"âŒ Error fetching courses:\", err);\r\n      setError(err.message || \"Failed to fetch courses\");\r\n      setCourses([]);\r\n    } finally {\r\n      setLoading(false);\r\n    }\r\n  }, [searchTerm, filters, pagination.currentPage, pagination.pageSize]);\r\n\r\n  // Perform search with same logic as fetch\r\n  const performSearch = useCallback(fetchCourses, [fetchCourses]);\r\n\r\n  // Update search term\r\n  const updateSearchTerm = useCallback((term) => {\r\n    setSearchTerm(term);\r\n    setPagination((prev) => ({ ...prev, currentPage: 1 })); // Reset to first page on search\r\n  }, []);\r\n\r\n  // Update filters\r\n  const updateFilters = useCallback((newFilters) => {\r\n    setFilters((prev) => ({ ...prev, ...newFilters }));\r\n    setPagination((prev) => ({ ...prev, currentPage: 1 })); // Reset to first page on filter change\r\n  }, []);\r\n\r\n  // Clear all filters and search\r\n  const clearSearch = useCallback(() => {\r\n    setSearchTerm(\"\");\r\n    setFilters({ is_active: user?.role === \"student\" ? \"true\" : \"\" });\r\n    setPagination((prev) => ({ ...prev, currentPage: 1 }));\r\n  }, [user]);\r\n\r\n  // Go to specific page\r\n  const goToPage = useCallback((page) => {\r\n    setPagination((prev) => ({ ...prev, currentPage: page }));\r\n  }, []);\r\n\r\n  // Change page size\r\n  const changePageSize = useCallback((size) => {\r\n    setPagination((prev) => ({\r\n      ...prev,\r\n      pageSize: size,\r\n      currentPage: 1, // Reset to first page when changing page size\r\n    }));\r\n  }, []);\r\n\r\n  // Computed values\r\n  const hasActiveSearch = useMemo(() => {\r\n    return (\r\n      searchTerm.trim() !== \"\" ||\r\n      Object.keys(filters).some(\r\n        (key) =>\r\n          filters[key] &&\r\n          filters[key] !== \"\" &&\r\n          !(\r\n            key === \"is_active\" &&\r\n            filters[key] === \"true\" &&\r\n            user?.role === \"student\"\r\n          )\r\n      )\r\n    );\r\n  }, [searchTerm, filters, user]);\r\n\r\n  const isEmpty = useMemo(() => courses.length === 0, [courses]);\r\n\r\n  const isFirstLoad = useMemo(\r\n    () => pagination.currentPage === 1 && !hasActiveSearch && !loading,\r\n    [pagination.currentPage, hasActiveSearch, loading]\r\n  );\r\n\r\n  return {\r\n    // Data\r\n    courses,\r\n    loading,\r\n    error,\r\n    pagination,\r\n\r\n    // Search state\r\n    searchTerm,\r\n    filters,\r\n    hasActiveSearch,\r\n    isEmpty,\r\n    isFirstLoad,\r\n\r\n    // Actions\r\n    updateSearchTerm,\r\n    updateFilters,\r\n    clearSearch,\r\n    goToPage,\r\n    changePageSize,\r\n    refresh: fetchCourses,\r\n\r\n    // Computed helpers\r\n    totalResults: pagination.totalCount,\r\n    currentPageStart: (pagination.currentPage - 1) * pagination.pageSize + 1,\r\n    currentPageEnd: Math.min(\r\n      pagination.currentPage * pagination.pageSize,\r\n      pagination.totalCount\r\n    ),\r\n  };\r\n};\r\n\r\nexport default useCourseSearch;\r\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}